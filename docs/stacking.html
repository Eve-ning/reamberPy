<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2024-03-23T16:17:06.2373102">        <title>Stacking | reamberPy</title><script type="application/json" id="virtual-toc-data">[{"id":"example","level":0,"title":"Example","anchor":"#example"},{"id":"including","level":0,"title":"Including","anchor":"#including"},{"id":"conditional-stacking","level":0,"title":"Conditional Stacking","anchor":"#conditional-stacking"},{"id":"mapset-stacking-caveats","level":0,"title":"MapSet Stacking Caveats","anchor":"#mapset-stacking-caveats"},{"id":"more-examples","level":0,"title":"More Examples","anchor":"#more-examples"},{"id":"settingwithcopy-warning","level":0,"title":"SettingWithCopy Warning","anchor":"#settingwithcopy-warning"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png">  <link rel="manifest" href="site.webmanifest">  <meta name="msapplication-TileColor" content="#000000"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png">  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Stacking | reamberPy"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="reamberPy Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="stacking.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Stacking | reamberPy"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "WebPage", "@id": "stacking.html#webpage", "url": "stacking.html", "name": "Stacking | reamberPy", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{ "@type": "WebSite", "@id": "/#website", "url": "/", "name": "reamberPy Help" }</script><!-- End Schema.org --></head>      <body data-id="Stacking" data-main-title="Stacking" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Learn"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>reamberPy  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Stacking"   id="Stacking.md">Stacking</h1>  <aside class="prompt" data-type="note" data-title="" id="1c87e7f5_393"><p id="1c87e7f5_394"><span class="control" id="1c87e7f5_395">Stacking joins all tables together regardless of type.</span></p></aside><section class="chapter"><h2 id="example" data-toc="example">Example</h2><p id="1c87e7f5_396">An example of a Hit List</p><div class="table-wrapper"><table class="wide" id="1c87e7f5_397"><thead><tr class="ijRowHead" id="1c87e7f5_398"><th id="1c87e7f5_399"><p>offset</p></th><th id="1c87e7f5_400"><p>column</p></th></tr></thead><tbody><tr id="1c87e7f5_401"><td id="1c87e7f5_402"><p>1000</p></td><td id="1c87e7f5_403"><p>2</p></td></tr><tr id="1c87e7f5_404"><td id="1c87e7f5_405"><p>2000</p></td><td id="1c87e7f5_406"><p>3</p></td></tr><tr id="1c87e7f5_407"><td id="1c87e7f5_408"><p>4000</p></td><td id="1c87e7f5_409"><p>1</p></td></tr></tbody></table></div><p id="1c87e7f5_410">An example of a Hold List</p><div class="table-wrapper"><table class="wide" id="1c87e7f5_411"><thead><tr class="ijRowHead" id="1c87e7f5_412"><th id="1c87e7f5_413"><p>offset</p></th><th id="1c87e7f5_414"><p>column</p></th><th id="1c87e7f5_415"><p>length</p></th></tr></thead><tbody><tr id="1c87e7f5_416"><td id="1c87e7f5_417"><p>1000</p></td><td id="1c87e7f5_418"><p>3</p></td><td id="1c87e7f5_419"><p>100</p></td></tr><tr id="1c87e7f5_420"><td id="1c87e7f5_421"><p>2000</p></td><td id="1c87e7f5_422"><p>2</p></td><td id="1c87e7f5_423"><p>200</p></td></tr><tr id="1c87e7f5_424"><td id="1c87e7f5_425"><p>3500</p></td><td id="1c87e7f5_426"><p>3</p></td><td id="1c87e7f5_427"><p>500</p></td></tr></tbody></table></div><p id="1c87e7f5_428">An example of a Bpm List</p><div class="table-wrapper"><table class="wide" id="1c87e7f5_429"><thead><tr class="ijRowHead" id="1c87e7f5_430"><th id="1c87e7f5_431"><p>offset</p></th><th id="1c87e7f5_432"><p>bpm</p></th><th id="1c87e7f5_433"><p>metronome</p></th></tr></thead><tbody><tr id="1c87e7f5_434"><td id="1c87e7f5_435"><p>1000</p></td><td id="1c87e7f5_436"><p>200</p></td><td id="1c87e7f5_437"><p>4</p></td></tr></tbody></table></div><p id="1c87e7f5_438">If we stacked them, we yield::</p><div class="table-wrapper"><table class="wide" id="1c87e7f5_439"><thead><tr class="ijRowHead" id="1c87e7f5_440"><th id="1c87e7f5_441"><p>offset</p></th><th id="1c87e7f5_442"><p>column</p></th><th id="1c87e7f5_443"><p>length</p></th><th id="1c87e7f5_444"><p>bpm</p></th><th id="1c87e7f5_445"><p>metronome</p></th></tr></thead><tbody><tr id="1c87e7f5_446"><td id="1c87e7f5_447"><p>1000</p></td><td id="1c87e7f5_448"><p>3</p></td><td id="1c87e7f5_449"><p>100</p></td><td id="1c87e7f5_450"></td><td id="1c87e7f5_451"></td></tr><tr id="1c87e7f5_452"><td id="1c87e7f5_453"><p>2000</p></td><td id="1c87e7f5_454"><p>2</p></td><td id="1c87e7f5_455"><p>200</p></td><td id="1c87e7f5_456"></td><td id="1c87e7f5_457"></td></tr><tr id="1c87e7f5_458"><td id="1c87e7f5_459"><p>3500</p></td><td id="1c87e7f5_460"><p>3</p></td><td id="1c87e7f5_461"><p>500</p></td><td id="1c87e7f5_462"></td><td id="1c87e7f5_463"></td></tr><tr id="1c87e7f5_464"><td id="1c87e7f5_465"><p>1000</p></td><td id="1c87e7f5_466"><p>2</p></td><td id="1c87e7f5_467"></td><td id="1c87e7f5_468"></td><td id="1c87e7f5_469"></td></tr><tr id="1c87e7f5_470"><td id="1c87e7f5_471"><p>2000</p></td><td id="1c87e7f5_472"><p>3</p></td><td id="1c87e7f5_473"></td><td id="1c87e7f5_474"></td><td id="1c87e7f5_475"></td></tr><tr id="1c87e7f5_476"><td id="1c87e7f5_477"><p>4000</p></td><td id="1c87e7f5_478"><p>1</p></td><td id="1c87e7f5_479"></td><td id="1c87e7f5_480"></td><td id="1c87e7f5_481"></td></tr><tr id="1c87e7f5_482"><td id="1c87e7f5_483"><p>1000</p></td><td id="1c87e7f5_484"></td><td id="1c87e7f5_485"></td><td id="1c87e7f5_486"><p>200</p></td><td id="1c87e7f5_487"><p>4</p></td></tr></tbody></table></div><p id="1c87e7f5_488">This allows us to modify <span class="control" id="1c87e7f5_489">all</span> matching properties at one go.</p><aside class="prompt" data-type="tip" data-title="" id="1c87e7f5_490"><p id="1c87e7f5_491">Note that empty cells are <code class="code" id="1c87e7f5_492">NaN</code>.</p></aside><aside class="prompt" data-type="note" data-title="" id="1c87e7f5_493"><p id="1c87e7f5_494">If you're familiar with <code class="code" id="1c87e7f5_495">pd.DataFrame</code>, basic operations such as <code class="code" id="1c87e7f5_496">+=</code>, <code class="code" id="1c87e7f5_497">/=</code> work here.</p></aside><p id="1c87e7f5_498">Here's how to use <code class="code" id="1c87e7f5_499">stack</code> to add offset to everything.</p><div class="tabs" id="1c87e7f5_500"><div class="tabs__content" data-gtm="tab" id="1c87e7f5_501" data-title="osu!mania"><div class="code-block" data-lang="python" data-title="Python">
from reamber.osu.OsuMap import OsuMap
m = OsuMap.read_file(...)
s = m.stack()
s.offset += 100
</div></div><div class="tabs__content" data-gtm="tab" id="1c87e7f5_503" data-title="Quaver"><div class="code-block" data-lang="python" data-title="Python">
from reamber.quaver.QuaMap import QuaMap
m = QuaMap.read_file(...)
s = m.stack()
s.offset += 100
</div></div><div class="tabs__content" data-gtm="tab" id="1c87e7f5_505" data-title="BMS"><div class="code-block" data-lang="python" data-title="Python">
from reamber.bms import BMSMap
m = BMSMap.read_file(...)
s = m.stack()
s.offset += 100
</div></div><div class="tabs__content" data-gtm="tab" id="1c87e7f5_507" data-title="Stepmania"><div class="code-block" data-lang="python" data-title="Python">
from reamber.sm import SMMapSet
ms = SMMapSet.read_file(...)
s = ms.stack()
s.offset += 100
</div></div><div class="tabs__content" data-gtm="tab" id="1c87e7f5_509" data-title="O2Jam"><div class="code-block" data-lang="python" data-title="Python">
from reamber.o2jam import O2JMapSet
ms = O2JMapSet.read_file(...)
s = ms.stack()
s.offset += 100
</div></div></div></section><section class="chapter"><h2 id="including" data-toc="including">Including</h2><p id="1c87e7f5_511">If you only wanted to change <code class="code" id="1c87e7f5_512">hits</code> column only, you can pass it as an argument</p><div class="code-block" data-lang="python">
from reamber.osu import OsuMap
from reamber.osu.lists.notes import OsuHitList

m = OsuMap.read_file(&quot;my_map.osu&quot;)
s = m.stack([OsuHitList])
</div><aside class="prompt" data-type="warning" data-title="" id="1c87e7f5_514"><p id="1c87e7f5_515">Note that including only some classes will remove some properties</p><p id="1c87e7f5_516">E.g. The above will not have <code class="code" id="1c87e7f5_517">length</code> property despite type-hinting showing it is available.</p></aside></section><section class="chapter"><h2 id="conditional-stacking" data-toc="conditional-stacking">Conditional Stacking</h2><p id="1c87e7f5_518"><span class="control" id="1c87e7f5_519">Condition Stacking only works on Map, not Mapset, see below for workaround</span></p><p id="1c87e7f5_520">If you're familiar with <code class="code" id="1c87e7f5_521">pd.DataFrame</code>, you can do something like</p><div class="code-block" data-lang="python">
import pandas as pd

df = pd.DataFrame(...)
df.loc[df.offset &lt; 1000, 'column'] += 1
</div><p id="1c87e7f5_523">This adds column by 1 where <code class="code" id="1c87e7f5_524">df.offset</code> is less than 1000.</p><p id="1c87e7f5_525">For stacking, you <span class="control" id="1c87e7f5_526">MUST</span> also do it through <code class="code" id="1c87e7f5_527">loc</code>.</p><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
stack.loc[stack.offset &lt; 1000, 'column'] += 1
</div><p id="1c87e7f5_529">Do not do it through the property.</p><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
# Don't do this
stack.column[stack.offset &lt; 1000] += 1
</div><p id="1c87e7f5_531">This raises a <code class="code" id="1c87e7f5_532">SettingWithCopy</code> warning! This means, it might not have updated the <code class="code" id="1c87e7f5_533">stack</code> by reference.</p></section><section class="chapter"><h2 id="mapset-stacking-caveats" data-toc="mapset-stacking-caveats">MapSet Stacking Caveats</h2><p id="1c87e7f5_534">When stacking with <code class="code" id="1c87e7f5_535">MapSet</code> s, it will return a <code class="code" id="1c87e7f5_536">pd.DataFrame</code> of the <code class="code" id="1c87e7f5_537">Map</code> stack results. Due to copying caveats, conditional stacking will not work, loop through the maps and set individually.</p><div class="code-block" data-lang="python">
from reamber.sm import SMMapSet

ms = SMMapSet.read_file(&quot;...&quot;)
stack = ms.stack()
stack.offset *= 2
</div><p id="1c87e7f5_539">If you want <span class="control" id="1c87e7f5_540">conditional stacking</span>, loop and <code class="code" id="1c87e7f5_541">loc</code>.</p><div class="code-block" data-lang="python">
from reamber.sm import SMMapSet

ms = SMMapSet.read_file(&quot;...&quot;)
for m in ms:
    s = m.stack()
    s.loc[s.offset &gt; 1000, 'column'] += 2
</div></section><section class="chapter"><h2 id="more-examples" data-toc="more-examples">More Examples</h2><p id="1c87e7f5_543">To get acquainted with this, here are some additional examples. Learning this will be equivalent to learning <code class="code" id="1c87e7f5_544">pd.DataFrame</code> conditional slicing and setting.</p><p id="1c87e7f5_545">We assume <code class="code" id="1c87e7f5_546">stack = m.stack()</code>, where <code class="code" id="1c87e7f5_547">m</code> is a map if not specified.</p><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="first-and-last-offsets" data-toc="first-and-last-offsets">First and Last Offsets</h3></div><div class="collapse__content"><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
first, last = stack.offset.min(), (stack.offset + stack.length).max()
</div><p id="1c87e7f5_549">Note that indexing will yield a <code class="code" id="1c87e7f5_550">pd.Series</code>.</p></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="reversing-columns" data-toc="reversing-columns">Reversing Columns</h3></div><div class="collapse__content"><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
keys = stack.column.max()
stack.column *= -1
stack.column += keys
</div></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="getting-columns-conditionally-by-offset" data-toc="getting-columns-conditionally-by-offset">Getting Columns Conditionally by Offset</h3></div><div class="collapse__content"><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
cols = stack.loc[stack.offset &gt;= 10000, 'column']
</div></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="multiple-conditions" data-toc="multiple-conditions">Multiple Conditions</h3></div><div class="collapse__content"><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
stack.loc[(stack.column == 2) &amp; (stack.offset &gt; 1000), 'column']
</div></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="multiple-properties" data-toc="multiple-properties">Multiple Properties</h3></div><div class="collapse__content"><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
stack.loc[(stack.column == 2) &amp;
          (stack.offset &gt; 1000), ['column', 'offset']] *= 2
</div></div></div></section></section><section class="chapter"><h2 id="settingwithcopy-warning" data-toc="settingwithcopy-warning">SettingWithCopy Warning</h2><p id="1c87e7f5_555"><span class="emphasis" id="1c87e7f5_556">If you're running into this issue, see above.</span></p><aside class="prompt" data-type="tip" data-title="" id="1c87e7f5_557"><p id="1c87e7f5_558"><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy" id="1c87e7f5_559" data-external="true" rel="noopener noreferrer">This is due to chained indexing</a></p></aside><p id="1c87e7f5_560">In short, when we write</p><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
stack.column[stack.offset &lt; 1000] += 1
</div><p id="1c87e7f5_562">It expands to</p><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
stack_copy = stack.__getitem__('column')
stack_copy[stack.offset &lt; 1000] += 1
</div><p id="1c87e7f5_564">Notice that <code class="code" id="1c87e7f5_565">stack_copy</code> may or may not be a copy, thus, it may not update the <code class="code" id="1c87e7f5_566">stack</code>.</p></section><div class="last-modified">Last modified: 23 March 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"> <a href="workingwithmaps.html" class="navigation-links__prev">Working with Maps</a><a href="buildingblocks.html" class="navigation-links__next">Building Blocks of ReamberPy</a> </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>