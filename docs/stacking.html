<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-10-21T19:20:41.8078899"><meta name="build-number" content="${buildNumber}">       <title>Stacking | reamberPy</title><script id="virtual-toc-data" type="application/json">[{"id":"example","level":0,"title":"Example","anchor":"#example"},{"id":"including","level":0,"title":"Including","anchor":"#including"},{"id":"conditional-stacking","level":0,"title":"Conditional Stacking","anchor":"#conditional-stacking"},{"id":"mapset-stacking-caveats","level":0,"title":"MapSet Stacking Caveats","anchor":"#mapset-stacking-caveats"},{"id":"more-examples","level":0,"title":"More Examples","anchor":"#more-examples"},{"id":"settingwithcopy-warning","level":0,"title":"SettingWithCopy Warning","anchor":"#settingwithcopy-warning"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.1.5-b176/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Stacking | reamberPy"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="reamberPy Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="stacking.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Stacking | reamberPy"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "stacking.html#webpage", "url": "stacking.html", "name": "Stacking | reamberPy", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/#website", "url": "/", "name": "reamberPy Help" }</script><!-- End Schema.org --> <!-- Mermaid light/dark themes -->  <link rel="stylesheet" type="text/css" href="mermaid.css">  </head>     <body data-id="Stacking" data-main-title="Stacking" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Learn"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>reamberPy  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Stacking"  id="Stacking.md"  >Stacking</h1>  <aside class="prompt" data-type="note" data-title="" id="612c6a0c_25677"><p id="612c6a0c_25678"><span class="control" id="612c6a0c_25679">Stacking joins all tables together regardless of type.</span></p></aside><section class="chapter"><h2 id="example" data-toc="example">Example</h2><p id="612c6a0c_25680">An example of a Hit List</p><div class="table-wrapper" ><table class="wide" id="612c6a0c_25681"  ><thead><tr class="ijRowHead" id="612c6a0c_25682"><th id="612c6a0c_25683"><p>offset</p></th><th id="612c6a0c_25684"><p>column</p></th></tr></thead><tbody ><tr id="612c6a0c_25685"><td id="612c6a0c_25686"><p>1000</p></td><td id="612c6a0c_25687"><p>2</p></td></tr><tr id="612c6a0c_25688"><td id="612c6a0c_25689"><p>2000</p></td><td id="612c6a0c_25690"><p>3</p></td></tr><tr id="612c6a0c_25691"><td id="612c6a0c_25692"><p>4000</p></td><td id="612c6a0c_25693"><p>1</p></td></tr></tbody ></table ></div><p id="612c6a0c_25694">An example of a Hold List</p><div class="table-wrapper" ><table class="wide" id="612c6a0c_25695"  ><thead><tr class="ijRowHead" id="612c6a0c_25696"><th id="612c6a0c_25697"><p>offset</p></th><th id="612c6a0c_25698"><p>column</p></th><th id="612c6a0c_25699"><p>length</p></th></tr></thead><tbody ><tr id="612c6a0c_25700"><td id="612c6a0c_25701"><p>1000</p></td><td id="612c6a0c_25702"><p>3</p></td><td id="612c6a0c_25703"><p>100</p></td></tr><tr id="612c6a0c_25704"><td id="612c6a0c_25705"><p>2000</p></td><td id="612c6a0c_25706"><p>2</p></td><td id="612c6a0c_25707"><p>200</p></td></tr><tr id="612c6a0c_25708"><td id="612c6a0c_25709"><p>3500</p></td><td id="612c6a0c_25710"><p>3</p></td><td id="612c6a0c_25711"><p>500</p></td></tr></tbody ></table ></div><p id="612c6a0c_25712">An example of a Bpm List</p><div class="table-wrapper" ><table class="wide" id="612c6a0c_25713"  ><thead><tr class="ijRowHead" id="612c6a0c_25714"><th id="612c6a0c_25715"><p>offset</p></th><th id="612c6a0c_25716"><p>bpm</p></th><th id="612c6a0c_25717"><p>metronome</p></th></tr></thead><tbody ><tr id="612c6a0c_25718"><td id="612c6a0c_25719"><p>1000</p></td><td id="612c6a0c_25720"><p>200</p></td><td id="612c6a0c_25721"><p>4</p></td></tr></tbody ></table ></div><p id="612c6a0c_25722">If we stacked them, we yield::</p><div class="table-wrapper" ><table class="wide" id="612c6a0c_25723"  ><thead><tr class="ijRowHead" id="612c6a0c_25724"><th id="612c6a0c_25725"><p>offset</p></th><th id="612c6a0c_25726"><p>column</p></th><th id="612c6a0c_25727"><p>length</p></th><th id="612c6a0c_25728"><p>bpm</p></th><th id="612c6a0c_25729"><p>metronome</p></th></tr></thead><tbody ><tr id="612c6a0c_25730"><td id="612c6a0c_25731"><p>1000</p></td><td id="612c6a0c_25732"><p>3</p></td><td id="612c6a0c_25733"><p>100</p></td><td id="612c6a0c_25734"></td><td id="612c6a0c_25735"></td></tr><tr id="612c6a0c_25736"><td id="612c6a0c_25737"><p>2000</p></td><td id="612c6a0c_25738"><p>2</p></td><td id="612c6a0c_25739"><p>200</p></td><td id="612c6a0c_25740"></td><td id="612c6a0c_25741"></td></tr><tr id="612c6a0c_25742"><td id="612c6a0c_25743"><p>3500</p></td><td id="612c6a0c_25744"><p>3</p></td><td id="612c6a0c_25745"><p>500</p></td><td id="612c6a0c_25746"></td><td id="612c6a0c_25747"></td></tr><tr id="612c6a0c_25748"><td id="612c6a0c_25749"><p>1000</p></td><td id="612c6a0c_25750"><p>2</p></td><td id="612c6a0c_25751"></td><td id="612c6a0c_25752"></td><td id="612c6a0c_25753"></td></tr><tr id="612c6a0c_25754"><td id="612c6a0c_25755"><p>2000</p></td><td id="612c6a0c_25756"><p>3</p></td><td id="612c6a0c_25757"></td><td id="612c6a0c_25758"></td><td id="612c6a0c_25759"></td></tr><tr id="612c6a0c_25760"><td id="612c6a0c_25761"><p>4000</p></td><td id="612c6a0c_25762"><p>1</p></td><td id="612c6a0c_25763"></td><td id="612c6a0c_25764"></td><td id="612c6a0c_25765"></td></tr><tr id="612c6a0c_25766"><td id="612c6a0c_25767"><p>1000</p></td><td id="612c6a0c_25768"></td><td id="612c6a0c_25769"></td><td id="612c6a0c_25770"><p>200</p></td><td id="612c6a0c_25771"><p>4</p></td></tr></tbody ></table ></div><p id="612c6a0c_25772">This allows us to modify <span class="control" id="612c6a0c_25773">all</span> matching properties at one go.</p><aside class="prompt" data-type="tip" data-title="" id="612c6a0c_25774"><p id="612c6a0c_25775">Note that empty cells are <code class="code" id="612c6a0c_25776">NaN</code>.</p></aside><aside class="prompt" data-type="note" data-title="" id="612c6a0c_25777"><p id="612c6a0c_25778">If you're familiar with <code class="code" id="612c6a0c_25779">pd.DataFrame</code>, basic operations such as <code class="code" id="612c6a0c_25780">+=</code>, <code class="code" id="612c6a0c_25781">/=</code> work here.</p></aside><p id="612c6a0c_25782">Here's how to use <code class="code" id="612c6a0c_25783">stack</code> to add offset to everything.</p><div class="tabs" id="612c6a0c_25784"><div class="tabs__content" data-gtm="tab" id="612c6a0c_25785"   data-title="osu!mania" ><div class="code-block" data-lang="python"    data-title="Python"     >
from reamber.osu.OsuMap import OsuMap
m = OsuMap.read_file(...)
s = m.stack()
s.offset += 100
</div></div><div class="tabs__content" data-gtm="tab" id="612c6a0c_25787"   data-title="Quaver" ><div class="code-block" data-lang="python"    data-title="Python"     >
from reamber.quaver.QuaMap import QuaMap
m = QuaMap.read_file(...)
s = m.stack()
s.offset += 100
</div></div><div class="tabs__content" data-gtm="tab" id="612c6a0c_25789"   data-title="BMS" ><div class="code-block" data-lang="python"    data-title="Python"     >
from reamber.bms import BMSMap
m = BMSMap.read_file(...)
s = m.stack()
s.offset += 100
</div></div><div class="tabs__content" data-gtm="tab" id="612c6a0c_25791"   data-title="Stepmania" ><div class="code-block" data-lang="python"    data-title="Python"     >
from reamber.sm import SMMapSet
ms = SMMapSet.read_file(...)
s = ms.stack()
s.offset += 100
</div></div><div class="tabs__content" data-gtm="tab" id="612c6a0c_25793"   data-title="O2Jam" ><div class="code-block" data-lang="python"    data-title="Python"     >
from reamber.o2jam import O2JMapSet
ms = O2JMapSet.read_file(...)
s = ms.stack()
s.offset += 100
</div></div></div></section><section class="chapter"><h2 id="including" data-toc="including">Including</h2><p id="612c6a0c_25795">If you only wanted to change <code class="code" id="612c6a0c_25796">hits</code> column only, you can pass it as an argument</p><div class="code-block" data-lang="python"         >
from reamber.osu import OsuMap
from reamber.osu.lists.notes import OsuHitList

m = OsuMap.read_file(&quot;my_map.osu&quot;)
s = m.stack([OsuHitList])
</div><aside class="prompt" data-type="warning" data-title="" id="612c6a0c_25798"><p id="612c6a0c_25799">Note that including only some classes will remove some properties</p><p id="612c6a0c_25800">E.g. The above will not have <code class="code" id="612c6a0c_25801">length</code> property despite type-hinting showing it is available.</p></aside></section><section class="chapter"><h2 id="conditional-stacking" data-toc="conditional-stacking">Conditional Stacking</h2><p id="612c6a0c_25802"><span class="control" id="612c6a0c_25803">Condition Stacking only works on Map, not Mapset, see below for workaround</span></p><p id="612c6a0c_25804">If you're familiar with <code class="code" id="612c6a0c_25805">pd.DataFrame</code>, you can do something like</p><div class="code-block" data-lang="python"         >
import pandas as pd

df = pd.DataFrame(...)
df.loc[df.offset &lt; 1000, 'column'] += 1
</div><p id="612c6a0c_25807">This adds column by 1 where <code class="code" id="612c6a0c_25808">df.offset</code> is less than 1000.</p><p id="612c6a0c_25809">For stacking, you <span class="control" id="612c6a0c_25810">MUST</span> also do it through <code class="code" id="612c6a0c_25811">loc</code>.</p><div class="code-block" data-lang="python"         >
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
stack.loc[stack.offset &lt; 1000, 'column'] += 1
</div><p id="612c6a0c_25813">Do not do it through the property.</p><div class="code-block" data-lang="python"         >
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
# Don't do this
stack.column[stack.offset &lt; 1000] += 1
</div><p id="612c6a0c_25815">This raises a <code class="code" id="612c6a0c_25816">SettingWithCopy</code> warning! This means, it might not have updated the <code class="code" id="612c6a0c_25817">stack</code> by reference.</p></section><section class="chapter"><h2 id="mapset-stacking-caveats" data-toc="mapset-stacking-caveats">MapSet Stacking Caveats</h2><p id="612c6a0c_25818">When stacking with <code class="code" id="612c6a0c_25819">MapSet</code> s, it will return a <code class="code" id="612c6a0c_25820">pd.DataFrame</code> of the <code class="code" id="612c6a0c_25821">Map</code> stack results. Due to copying caveats, conditional stacking will not work, loop through the maps and set individually.</p><div class="code-block" data-lang="python"         >
from reamber.sm import SMMapSet

ms = SMMapSet.read_file(&quot;...&quot;)
stack = ms.stack()
stack.offset *= 2
</div><p id="612c6a0c_25823">If you want <span class="control" id="612c6a0c_25824">conditional stacking</span>, loop and <code class="code" id="612c6a0c_25825">loc</code>.</p><div class="code-block" data-lang="python"         >
from reamber.sm import SMMapSet

ms = SMMapSet.read_file(&quot;...&quot;)
for m in ms:
    s = m.stack()
    s.loc[s.offset &gt; 1000, 'column'] += 2
</div></section><section class="chapter"><h2 id="more-examples" data-toc="more-examples">More Examples</h2><p id="612c6a0c_25827">To get acquainted with this, here are some additional examples. Learning this will be equivalent to learning <code class="code" id="612c6a0c_25828">pd.DataFrame</code> conditional slicing and setting.</p><p id="612c6a0c_25829">We assume <code class="code" id="612c6a0c_25830">stack = m.stack()</code>, where <code class="code" id="612c6a0c_25831">m</code> is a map if not specified.</p><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="first-and-last-offsets" data-toc="first-and-last-offsets">First and Last Offsets</h3></div><div class="collapse__content"><div class="code-block" data-lang="python"         >
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
first, last = stack.offset.min(), (stack.offset + stack.length).max()
</div><p id="612c6a0c_25833">Note that indexing will yield a <code class="code" id="612c6a0c_25834">pd.Series</code>.</p></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="reversing-columns" data-toc="reversing-columns">Reversing Columns</h3></div><div class="collapse__content"><div class="code-block" data-lang="python"         >
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
keys = stack.column.max()
stack.column *= -1
stack.column += keys
</div></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="getting-columns-conditionally-by-offset" data-toc="getting-columns-conditionally-by-offset">Getting Columns Conditionally by Offset</h3></div><div class="collapse__content"><div class="code-block" data-lang="python"         >
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
cols = stack.loc[stack.offset &gt;= 10000, 'column']
</div></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="multiple-conditions" data-toc="multiple-conditions">Multiple Conditions</h3></div><div class="collapse__content"><div class="code-block" data-lang="python"         >
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
stack.loc[(stack.column == 2) &amp; (stack.offset &gt; 1000), 'column']
</div></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="multiple-properties" data-toc="multiple-properties">Multiple Properties</h3></div><div class="collapse__content"><div class="code-block" data-lang="python"         >
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
stack.loc[(stack.column == 2) &amp;
          (stack.offset &gt; 1000), ['column', 'offset']] *= 2
</div></div></div></section></section><section class="chapter"><h2 id="settingwithcopy-warning" data-toc="settingwithcopy-warning">SettingWithCopy Warning</h2><p id="612c6a0c_25839"><span class="emphasis" id="612c6a0c_25840">If you're running into this issue, see above.</span></p><aside class="prompt" data-type="tip" data-title="" id="612c6a0c_25841"><p id="612c6a0c_25842"><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy" id="612c6a0c_25843"   data-external="true" rel="noopener noreferrer" >This is due to chained indexing</a></p></aside><p id="612c6a0c_25844">In short, when we write</p><div class="code-block" data-lang="python"         >
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
stack.column[stack.offset &lt; 1000] += 1
</div><p id="612c6a0c_25846">It expands to</p><div class="code-block" data-lang="python"         >
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
stack_copy = stack.__getitem__('column')
stack_copy[stack.offset &lt; 1000] += 1
</div><p id="612c6a0c_25848">Notice that <code class="code" id="612c6a0c_25849">stack_copy</code> may or may not be a copy, thus, it may not update the <code class="code" id="612c6a0c_25850">stack</code>.</p></section><div class="last-modified"> Last modified: 21 October 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="workingwithmaps.html">Working with Maps</a>   <a class="navigation-links__next" href="buildingblocks.html">Building Blocks of ReamberPy</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.1.5-b176/app.js"></script></body></html>