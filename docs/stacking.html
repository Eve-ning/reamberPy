<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-11-08T20:55:58.444078446"><title>Stacking | reamberPy</title><script type="application/json" id="virtual-toc-data">[{"id":"example","level":0,"title":"Example","anchor":"#example"},{"id":"including","level":0,"title":"Including","anchor":"#including"},{"id":"conditional-stacking","level":0,"title":"Conditional Stacking","anchor":"#conditional-stacking"},{"id":"mapset-stacking-caveats","level":0,"title":"MapSet Stacking Caveats","anchor":"#mapset-stacking-caveats"},{"id":"more-examples","level":0,"title":"More Examples","anchor":"#more-examples"},{"id":"settingwithcopy-warning","level":0,"title":"SettingWithCopy Warning","anchor":"#settingwithcopy-warning"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b419/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Stacking | reamberPy"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="reamberPy Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/stacking.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Stacking | reamberPy"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/stacking.html#webpage",
    "url": "writerside-documentation/stacking.html",
    "name": "Stacking | reamberPy",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "reamberPy Help"
}</script><!-- End Schema.org --></head><body data-id="Stacking" data-main-title="Stacking" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Learn"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>reamberPy  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Stacking" id="Stacking.md">Stacking</h1><aside class="prompt" data-type="note" data-title="" id="-eoxhyi_3"><p id="-eoxhyi_10"><span class="control" id="-eoxhyi_11">Stacking joins all tables together regardless of type.</span></p></aside><section class="chapter"><h2 id="example" data-toc="example">Example</h2><p id="-eoxhyi_12">An example of a Hit List</p><div class="table-wrapper"><table class="wide" id="-eoxhyi_13"><thead><tr class="ijRowHead" id="-eoxhyi_25"><th id="-eoxhyi_29"><p>offset</p></th><th id="-eoxhyi_30"><p>column</p></th></tr></thead><tbody><tr id="-eoxhyi_26"><td id="-eoxhyi_31"><p>1000</p></td><td id="-eoxhyi_32"><p>2</p></td></tr><tr id="-eoxhyi_27"><td id="-eoxhyi_33"><p>2000</p></td><td id="-eoxhyi_34"><p>3</p></td></tr><tr id="-eoxhyi_28"><td id="-eoxhyi_35"><p>4000</p></td><td id="-eoxhyi_36"><p>1</p></td></tr></tbody></table></div><p id="-eoxhyi_14">An example of a Hold List</p><div class="table-wrapper"><table class="wide" id="-eoxhyi_15"><thead><tr class="ijRowHead" id="-eoxhyi_37"><th id="-eoxhyi_41"><p>offset</p></th><th id="-eoxhyi_42"><p>column</p></th><th id="-eoxhyi_43"><p>length</p></th></tr></thead><tbody><tr id="-eoxhyi_38"><td id="-eoxhyi_44"><p>1000</p></td><td id="-eoxhyi_45"><p>3</p></td><td id="-eoxhyi_46"><p>100</p></td></tr><tr id="-eoxhyi_39"><td id="-eoxhyi_47"><p>2000</p></td><td id="-eoxhyi_48"><p>2</p></td><td id="-eoxhyi_49"><p>200</p></td></tr><tr id="-eoxhyi_40"><td id="-eoxhyi_50"><p>3500</p></td><td id="-eoxhyi_51"><p>3</p></td><td id="-eoxhyi_52"><p>500</p></td></tr></tbody></table></div><p id="-eoxhyi_16">An example of a Bpm List</p><div class="table-wrapper"><table class="wide" id="-eoxhyi_17"><thead><tr class="ijRowHead" id="-eoxhyi_53"><th id="-eoxhyi_55"><p>offset</p></th><th id="-eoxhyi_56"><p>bpm</p></th><th id="-eoxhyi_57"><p>metronome</p></th></tr></thead><tbody><tr id="-eoxhyi_54"><td id="-eoxhyi_58"><p>1000</p></td><td id="-eoxhyi_59"><p>200</p></td><td id="-eoxhyi_60"><p>4</p></td></tr></tbody></table></div><p id="-eoxhyi_18">If we stacked them, we yield::</p><div class="table-wrapper"><table class="wide" id="-eoxhyi_19"><thead><tr class="ijRowHead" id="-eoxhyi_61"><th id="-eoxhyi_69"><p>offset</p></th><th id="-eoxhyi_70"><p>column</p></th><th id="-eoxhyi_71"><p>length</p></th><th id="-eoxhyi_72"><p>bpm</p></th><th id="-eoxhyi_73"><p>metronome</p></th></tr></thead><tbody><tr id="-eoxhyi_62"><td id="-eoxhyi_74"><p>1000</p></td><td id="-eoxhyi_75"><p>3</p></td><td id="-eoxhyi_76"><p>100</p></td><td id="-eoxhyi_77"></td><td id="-eoxhyi_78"></td></tr><tr id="-eoxhyi_63"><td id="-eoxhyi_79"><p>2000</p></td><td id="-eoxhyi_80"><p>2</p></td><td id="-eoxhyi_81"><p>200</p></td><td id="-eoxhyi_82"></td><td id="-eoxhyi_83"></td></tr><tr id="-eoxhyi_64"><td id="-eoxhyi_84"><p>3500</p></td><td id="-eoxhyi_85"><p>3</p></td><td id="-eoxhyi_86"><p>500</p></td><td id="-eoxhyi_87"></td><td id="-eoxhyi_88"></td></tr><tr id="-eoxhyi_65"><td id="-eoxhyi_89"><p>1000</p></td><td id="-eoxhyi_90"><p>2</p></td><td id="-eoxhyi_91"></td><td id="-eoxhyi_92"></td><td id="-eoxhyi_93"></td></tr><tr id="-eoxhyi_66"><td id="-eoxhyi_94"><p>2000</p></td><td id="-eoxhyi_95"><p>3</p></td><td id="-eoxhyi_96"></td><td id="-eoxhyi_97"></td><td id="-eoxhyi_98"></td></tr><tr id="-eoxhyi_67"><td id="-eoxhyi_99"><p>4000</p></td><td id="-eoxhyi_100"><p>1</p></td><td id="-eoxhyi_101"></td><td id="-eoxhyi_102"></td><td id="-eoxhyi_103"></td></tr><tr id="-eoxhyi_68"><td id="-eoxhyi_104"><p>1000</p></td><td id="-eoxhyi_105"></td><td id="-eoxhyi_106"></td><td id="-eoxhyi_107"><p>200</p></td><td id="-eoxhyi_108"><p>4</p></td></tr></tbody></table></div><p id="-eoxhyi_20">This allows us to modify <span class="control" id="-eoxhyi_109">all</span> matching properties at one go.</p><aside class="prompt" data-type="tip" data-title="" id="-eoxhyi_21"><p id="-eoxhyi_110">Note that empty cells are <code class="code" id="-eoxhyi_111">NaN</code>.</p></aside><aside class="prompt" data-type="note" data-title="" id="-eoxhyi_22"><p id="-eoxhyi_112">If you're familiar with <code class="code" id="-eoxhyi_113">pd.DataFrame</code>, basic operations such as <code class="code" id="-eoxhyi_114">+=</code>, <code class="code" id="-eoxhyi_115">/=</code> work here.</p></aside><p id="-eoxhyi_23">Here's how to use <code class="code" id="-eoxhyi_116">stack</code> to add offset to everything.</p><div class="tabs" id="-eoxhyi_24" data-anchors="[-eoxhyi_117,-eoxhyi_118,-eoxhyi_119,-eoxhyi_120,-eoxhyi_121]"><div class="tabs__content" data-gtm="tab" id="-eoxhyi_117" data-title="osu!mania"><div class="code-block" data-lang="python" data-title="Python">
from reamber.osu.OsuMap import OsuMap
m = OsuMap.read_file(...)
s = m.stack()
s.offset += 100
</div></div><div class="tabs__content" data-gtm="tab" id="-eoxhyi_118" data-title="Quaver"><div class="code-block" data-lang="python" data-title="Python">
from reamber.quaver.QuaMap import QuaMap
m = QuaMap.read_file(...)
s = m.stack()
s.offset += 100
</div></div><div class="tabs__content" data-gtm="tab" id="-eoxhyi_119" data-title="BMS"><div class="code-block" data-lang="python" data-title="Python">
from reamber.bms import BMSMap
m = BMSMap.read_file(...)
s = m.stack()
s.offset += 100
</div></div><div class="tabs__content" data-gtm="tab" id="-eoxhyi_120" data-title="Stepmania"><div class="code-block" data-lang="python" data-title="Python">
from reamber.sm import SMMapSet
ms = SMMapSet.read_file(...)
s = ms.stack()
s.offset += 100
</div></div><div class="tabs__content" data-gtm="tab" id="-eoxhyi_121" data-title="O2Jam"><div class="code-block" data-lang="python" data-title="Python">
from reamber.o2jam import O2JMapSet
ms = O2JMapSet.read_file(...)
s = ms.stack()
s.offset += 100
</div></div></div></section><section class="chapter"><h2 id="including" data-toc="including">Including</h2><p id="-eoxhyi_127">If you only wanted to change <code class="code" id="-eoxhyi_130">hits</code> column only, you can pass it as an argument</p><div class="code-block" data-lang="python">
from reamber.osu import OsuMap
from reamber.osu.lists.notes import OsuHitList

m = OsuMap.read_file(&quot;my_map.osu&quot;)
s = m.stack([OsuHitList])
</div><aside class="prompt" data-type="warning" data-title="" id="-eoxhyi_129"><p id="-eoxhyi_131">Note that including only some classes will remove some properties</p><p id="-eoxhyi_132">E.g. The above will not have <code class="code" id="-eoxhyi_133">length</code> property despite type-hinting showing it is available.</p></aside></section><section class="chapter"><h2 id="conditional-stacking" data-toc="conditional-stacking">Conditional Stacking</h2><p id="-eoxhyi_134"><span class="control" id="-eoxhyi_143">Condition Stacking only works on Map, not Mapset, see below for workaround</span></p><p id="-eoxhyi_135">If you're familiar with <code class="code" id="-eoxhyi_144">pd.DataFrame</code>, you can do something like</p><div class="code-block" data-lang="python">
import pandas as pd

df = pd.DataFrame(...)
df.loc[df.offset &lt; 1000, 'column'] += 1
</div><p id="-eoxhyi_137">This adds column by 1 where <code class="code" id="-eoxhyi_145">df.offset</code> is less than 1000.</p><p id="-eoxhyi_138">For stacking, you <span class="control" id="-eoxhyi_146">MUST</span> also do it through <code class="code" id="-eoxhyi_147">loc</code>.</p><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
stack.loc[stack.offset &lt; 1000, 'column'] += 1
</div><p id="-eoxhyi_140">Do not do it through the property.</p><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
# Don't do this
stack.column[stack.offset &lt; 1000] += 1
</div><p id="-eoxhyi_142">This raises a <code class="code" id="-eoxhyi_148">SettingWithCopy</code> warning! This means, it might not have updated the <code class="code" id="-eoxhyi_149">stack</code> by reference.</p></section><section class="chapter"><h2 id="mapset-stacking-caveats" data-toc="mapset-stacking-caveats">MapSet Stacking Caveats</h2><p id="-eoxhyi_150">When stacking with <code class="code" id="-eoxhyi_154">MapSet</code> s, it will return a <code class="code" id="-eoxhyi_155">pd.DataFrame</code> of the <code class="code" id="-eoxhyi_156">Map</code> stack results. Due to copying caveats, conditional stacking will not work, loop through the maps and set individually.</p><div class="code-block" data-lang="python">
from reamber.sm import SMMapSet

ms = SMMapSet.read_file(&quot;...&quot;)
stack = ms.stack()
stack.offset *= 2
</div><p id="-eoxhyi_152">If you want <span class="control" id="-eoxhyi_157">conditional stacking</span>, loop and <code class="code" id="-eoxhyi_158">loc</code>.</p><div class="code-block" data-lang="python">
from reamber.sm import SMMapSet

ms = SMMapSet.read_file(&quot;...&quot;)
for m in ms:
    s = m.stack()
    s.loc[s.offset &gt; 1000, 'column'] += 2
</div></section><section class="chapter"><h2 id="more-examples" data-toc="more-examples">More Examples</h2><p id="-eoxhyi_159">To get acquainted with this, here are some additional examples. Learning this will be equivalent to learning <code class="code" id="-eoxhyi_166">pd.DataFrame</code> conditional slicing and setting.</p><p id="-eoxhyi_160">We assume <code class="code" id="-eoxhyi_167">stack = m.stack()</code>, where <code class="code" id="-eoxhyi_168">m</code> is a map if not specified.</p><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="first-and-last-offsets" data-toc="first-and-last-offsets">First and Last Offsets</h3></div><div class="collapse__content"><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
first, last = stack.offset.min(), (stack.offset + stack.length).max()
</div><p id="-eoxhyi_170">Note that indexing will yield a <code class="code" id="-eoxhyi_171">pd.Series</code>.</p></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="reversing-columns" data-toc="reversing-columns">Reversing Columns</h3></div><div class="collapse__content"><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
keys = stack.column.max()
stack.column *= -1
stack.column += keys
</div></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="getting-columns-conditionally-by-offset" data-toc="getting-columns-conditionally-by-offset">Getting Columns Conditionally by Offset</h3></div><div class="collapse__content"><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
cols = stack.loc[stack.offset &gt;= 10000, 'column']
</div></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="multiple-conditions" data-toc="multiple-conditions">Multiple Conditions</h3></div><div class="collapse__content"><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
stack.loc[(stack.column == 2) &amp; (stack.offset &gt; 1000), 'column']
</div></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="multiple-properties" data-toc="multiple-properties">Multiple Properties</h3></div><div class="collapse__content"><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
stack.loc[(stack.column == 2) &amp;
          (stack.offset &gt; 1000), ['column', 'offset']] *= 2
</div></div></div></section></section><section class="chapter"><h2 id="settingwithcopy-warning" data-toc="settingwithcopy-warning">SettingWithCopy Warning</h2><p id="-eoxhyi_176"><span class="emphasis" id="-eoxhyi_183">If you're running into this issue, see above.</span></p><aside class="prompt" data-type="tip" data-title="" id="-eoxhyi_177"><p id="-eoxhyi_184"><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy" id="-eoxhyi_185" data-external="true" rel="noopener noreferrer">This is due to chained indexing</a></p></aside><p id="-eoxhyi_178">In short, when we write</p><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
stack.column[stack.offset &lt; 1000] += 1
</div><p id="-eoxhyi_180">It expands to</p><div class="code-block" data-lang="python">
from reamber.osu import OsuMap

stack = OsuMap.read_file(&quot;...&quot;).stack()
stack_copy = stack.__getitem__('column')
stack_copy[stack.offset &lt; 1000] += 1
</div><p id="-eoxhyi_182">Notice that <code class="code" id="-eoxhyi_186">stack_copy</code> may or may not be a copy, thus, it may not update the <code class="code" id="-eoxhyi_187">stack</code>.</p></section><div class="last-modified">Last modified: 08 November 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="workingwithmaps.html" class="navigation-links__prev">Working with Maps</a><a href="buildingblocks.html" class="navigation-links__next">Building Blocks of ReamberPy</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b419/app.js"></script></body></html>